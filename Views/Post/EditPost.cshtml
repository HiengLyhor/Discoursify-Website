@using Discoursify.Models;
@{
    ViewBag.Title = "EditPost";
    Layout = "~/Views/Shared/_Layout.cshtml";
    Post post = Model;
}


<script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script>
<body>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <link rel="stylesheet" href="~/Content/assets/css/style.css">
    
    <div class="common-structure">

        <aside class="side-a" style="padding-left: 20px">
            <section class="common-section">
            </section>
        </aside>


        <main class="main-feed">
            @* This is for the post title*@
            <input class="visually-hidden postKey" id="postKey" value="@post.UniqKey" />
            <div>
                <h1 id="editable-title" style="font-weight: bold; font-size: 35px; font-family: 'Times New Roman', Times, serif; margin-top: 15px; border: none; outline: none;" contenteditable="true">@post.Title</h1>
            </div>

            @* This is for the post owner and post date*@
        <div style="margin-top: 20px">
            <h2>
                <a style="color: black" href="/Profile/ViewOtherProfile?profile=@post.Owner">Created by: <span style="font-weight: bold">@post.Owner</span></a>
                &emsp;&emsp;
                <span>🟢</span> @post.PostDate
            </h2>

            <div class="summary u-flex" style="margin-top: 10px">
                <div class="reactions">👍</div>
                <div class="reactions-total">@post.Like</div>
                <div class="reactions">👎</div>
                <div class="reactions-total">@post.DisLike</div>
            </div>

            <hr style="margin-top: 20px; border: none; border-top: 2px solid #ccc;">

            @* Post image*@
            <div style="position: relative; display: inline-block; text-align: center;">
                <img id="editable-image" class="embed-content-image" src="/Image/@post.ImageUrl" alt="Post Image" onclick="openModal(this.src)" style="margin-top: 40px; transform: scale(75%);">
                <div style="text-align: center;">
                    <label for="image-input" class="custom-file-upload" style="display: inline-block;">Choose New Image... &emsp;<i class="fa fa-upload" aria-hidden="true"></i></label>
                    <input type="file" id="image-input" style="display: none;">
                </div>
            </div>


            <div id="imageModal" class="modal">
                <span class="close" onclick="closeModal()">&times;</span>
                <img class="modal-content" id="modalImage">
                <div id="caption">@post.Title</div>
            </div>

            @* This is for display post description*@
            <h2 id="editable-content" style="margin-top: 20px; line-height: 1.5; text-align: justify; text-justify: inter-word; font-size: 21px; color: #333; font-family: Arial, sans-serif; border: none; outline: none;" contenteditable="true">
                @post.Content
            </h2>

            <div style="position: relative; display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px">
                <button id="back" class="back-button" onclick="window.location.href='/Profile/ViewProfile'">Cancel</button>
                <button id="save-button" class="fancy-button">Edit Post</button>
            </div>

            <hr style="margin-top: 40px; border: none; border-top: 2px solid #ccc;">
        </div>


            <div style="margin-top: 20px; margin-bottom: 100px; opacity: 0.5">

                @if (post.PostComments.Count != 0)
                {
                    <div style="margin-top: 20px; cursor: not-allowed">Comment section</div>
                    foreach (var comment in post.PostComments)
                    {
                        <div class="comment" style="cursor: not-allowed">
                            <div class="vote-buttons">
                                <button disabled class="vote-button" id="upVoteCmt" onclick="UpComment('@comment.UniqueKey')" style="cursor: not-allowed"><span style="font-size: 16px">@comment.UpVote</span> &#9650;</button>
                                <br />
                                <button disabled class="vote-button" id="downVoteCmt" onclick="DownComment('@comment.UniqueKey')" style="cursor: not-allowed"><span style="font-size: 16px">@comment.DownVote</span> &#9660;</button>
                            </div>
                            <div class="comment-creator">🔵 @comment.CmtOwner</div>
                            <div class="comment-date">@comment.CommentDate</div>
                            <div class="comment-description">@comment.Description</div>
                        </div>
                    }
                }
                else
                {
                    <div style="color: #616569; margin-bottom: 100px">Oops! There are no comments for your post.</div>
                }

            </div>

            <style>
                .custom-file-upload {
                    display: inline-block;
                    padding: 6px 12px;
                    cursor: pointer;
                    background-color: #39D2B4;
                    color: white;
                    border-radius: 5px;
                    font-family: Arial, sans-serif;
                    transition: all .4s;
                    margin-top: 10px;
                }

                .fancy-button {
                    background-color: #4CAF50;
                    color: white;
                    padding: 10px 20px;
                    border: none;
                    border-radius: 5px;
                    font-size: 16px;
                    cursor: pointer;
                    transition: background-color 0.3s;
                    font-family: Arial, sans-serif;
                }

                .fancy-button:hover {
                    background-color: #45a049;
                }

                .fancy-button:active {
                    background-color: #3e8e41;
                }

                .back-button {
                    background-color: #f44336;
                    color: white;
                    padding: 10px 20px;
                    border: none;
                    border-radius: 5px;
                    font-size: 16px;
                    cursor: pointer;
                    transition: background-color 0.3s;
                    font-family: Arial, sans-serif;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 5px;
                }

                .back-button:hover {
                    background-color: #d32f2f;
                }

                .back-button:active {
                    background-color: #c62828;
                }

                .back-button i {
                    margin-right: 5px;
                }
            </style>

            <script>
                document.getElementById('image-input').addEventListener('change', function (event) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('editable-image').src = e.target.result;
                    };
                    reader.readAsDataURL(event.target.files[0]);
                });

                document.getElementById('save-button').addEventListener('click', function () {
                    var postKey = document.getElementById('postKey').value;
                    var newTitle = document.getElementById('editable-title').innerText;
                    var newContent = document.getElementById('editable-content').innerText;
                    var imageInput = document.getElementById('image-input');
                    var formData = new FormData();
                    formData.append('UniqKey', postKey);
                    formData.append('Title', newTitle);
                    formData.append('Content', newContent);

                    if (imageInput.files.length > 0) {
                        formData.append('ImageFile', imageInput.files[0]);
                    }

                    fetch('/Post/EditPost', {
                        method: 'POST',
                        body: formData
                    })
                        .then(response => response.json())
                        .then(data => {
                            // Handle the response
                            console.log('Success:', data);
                            alert('Post updated successfully!');
                            window.location.href = '/Profile/ViewProfile'; // Redirect to home page
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('An error occurred while updating the post.');
                        });
                });
            </script>
        </main>

        <aside class="side-b" style="padding-right: 20px">
            <section class="common-section"></section>
        </aside>
    </div>
    
</body>

<style>
    
    .comment {
        background-color: #f5f5f5;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 10px;
        position: relative;
    }

    .comment-creator {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }

    .comment-date {
        font-size: 12px;
        color: #777;
        margin-bottom: 5px;
    }

    .comment-description {
        color: #555;
    }

    .vote-buttons {
        position: absolute;
        top: 10px;
        right: 10px;
    }

    .vote-button {
        background: none;
        border: none;
        padding: 0;
        cursor: pointer;
        font-size: 20px;
        color: #777;
    }

    .comment-input-container {
        margin-top: 20px;
        max-width: 100%;
        display: flex;
        align-items: flex-start;
    }

    .comment-input {
        height: 50px;
        width: 88%;
        max-width: 1000%;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-bottom: 10px;
        resize: vertical;
    }

    .submit-button {
        margin-top: 7px;
        margin-left: 10px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 12px;
        cursor: pointer;
    }

    .error-message {
        color: red;
    }

    .success-message {
        color: green;
    }
    @* end *@
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        padding-top: 60px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.8);
    }

    /* Modal Content (Image) */
    .modal-content {
        margin: auto;
        display: block;
        width: 100%;
        max-width: 700px;
    }

    /* Caption of Modal Image */
    #caption {
        margin: auto;
        display: block;
        width: 80%;
        max-width: 700px;
        text-align: center;
        color: #ccc;
        padding: 10px 0;
    }

    /* Add Animation - Zoom in the Modal */
    .modal-content {
        animation-name: zoom;
        animation-duration: 0.6s;
    }

    /* The Close Button */
    .close {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
    }

    .close:hover,
    .close:focus {
        color: #bbb;
        text-decoration: none;
        cursor: pointer;
    }
</style>

<script>

    var submitButton = document.getElementById("submit-comment");
    var handleErrorDiv = document.getElementById("handle-error");

    function openModal(src) {
        var modal = document.getElementById("imageModal");
        var modalImg = document.getElementById("modalImage");
        modal.style.display = "block";
        modalImg.src = src;
    }

    function closeModal() {
        var modal = document.getElementById("imageModal");
        modal.style.display = "none";
    }

    function toggleModal(src) {
        var modal = document.getElementById("imageModal");
        var modalImg = document.getElementById("modalImage");
        if (modal.style.display === "block") {
            modal.style.display = "none";
        } else {
            modal.style.display = "block";
            modalImg.src = src;
        }
    }

    window.onscroll = function () {
        var modal = document.getElementById("imageModal");
        if (modal.style.display === "block") {
            modal.style.display = "none";
        }
    };
</script>